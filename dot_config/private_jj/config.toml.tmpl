"$schema" = "https://jj-vcs.github.io/jj/latest/config-schema.json"

[user]
name = "{{ .name }}"
email = "{{ .email }}"

[ui]
conflict-marker-style = "git"
default-command = "log"
diff-formatter = "difft"

[aliases]
gf = ["git", "fetch"]
nt = ["new", "trunk()"]
# rt = "retrunk". Rebase onto trunk (can specify source with -s)
rt = ["rebase", "-d", "trunk()"]
# rta = "retrunk all". Rebase all local branch roots onto latest trunk
rta = ["rebase", "-d", "trunk()", "-s", "local_roots"]
tug = ["bookmark", "move", "--from", "heads(::@- & bookmarks())", "--to", "@"]
tug- = ["bookmark", "move", "--from", "heads(::@- & bookmarks())", "--to", "@-"]

[merge-tools.difft]
program = "difft"
diff-args = ["--color=always", "$left", "$right"]

[revset-aliases]
# Redefine immutable_heads() to prevent rewriting others' commits
"immutable_heads()" = "builtin_immutable_heads() | (trunk().. & ~mine())"
# All local branch roots that are not in main(). Rebase these all together
"local_roots" = "roots(trunk()..(visible_heads() & mine() & ~immutable_heads()))"
# Root commits of all changes between trunk and the current commit
"stack_roots" = "roots(trunk()..@)"
# Local auto bookmarks associated with commits that are descended from trunk() (can be pushed together)
"local_auto_bookmarks" = "trunk().. & bookmarks(glob:'{{ .chezmoi.username }}/push-*') & mine()"

[templates]
git_push_bookmark = '"{{ .chezmoi.username }}/push-" ++ change_id.short()'
